<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Map Tile Server</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff;
        }

        .header {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #aaa;
            font-size: 14px;
            letter-spacing: 0.5px;
        }

        #map {
            width: 100%;
            height: calc(100vh - 100px);
        }

        .info-panel {
            position: absolute;
            top: 120px;
            right: 20px;
            background: rgba(30, 30, 30, 0.98);
            padding: 20px;
            border-radius: 12px;
            z-index: 1000;
            min-width: 280px;
            max-width: 320px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
            border: 1px solid rgba(76, 175, 80, 0.3);
            backdrop-filter: blur(10px);
        }

        .info-panel h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #4CAF50;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 8px;
        }

        .info-section {
            margin-bottom: 15px;
        }

        .info-section:last-child {
            margin-bottom: 0;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .info-label {
            color: #888;
            font-weight: 500;
        }

        .info-value {
            color: #fff;
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        .status {
            display: inline-block;
            padding: 4px 10px;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(76, 175, 80, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .coordinates-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(30, 30, 30, 0.98);
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 1px solid rgba(76, 175, 80, 0.3);
            backdrop-filter: blur(10px);
            min-width: 240px;
        }

        .coordinates-panel h4 {
            font-size: 14px;
            color: #4CAF50;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .coord-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .coord-label {
            color: #888;
        }

        .coord-value {
            color: #fff;
            font-family: 'Courier New', monospace;
            font-weight: 600;
        }

        .zoom-indicator {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(30, 30, 30, 0.98);
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 1px solid rgba(76, 175, 80, 0.3);
            backdrop-filter: blur(10px);
            text-align: center;
            min-width: 120px;
        }

        .zoom-indicator h4 {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .zoom-value {
            font-size: 36px;
            color: #4CAF50;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #444, transparent);
            margin: 12px 0;
        }

        code {
            color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .note {
            font-size: 12px;
            color: #888;
            line-height: 1.6;
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            border-left: 3px solid #4CAF50;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Custom Map Tile Server</h1>
        <p>Powered by nginx + Leaflet</p>
    </div>

    <div id="map"></div>

    <!-- Zoom Indicator -->
    <div class="zoom-indicator">
        <h4>Zoom Level</h4>
        <div class="zoom-value" id="zoom-level">0</div>
    </div>

    <!-- Coordinates Panel -->
    <div class="coordinates-panel">
        <h4>Current Position</h4>
        <div class="coord-row">
            <span class="coord-label">Latitude:</span>
            <span class="coord-value" id="lat-value">0.0000</span>
        </div>
        <div class="coord-row">
            <span class="coord-label">Longitude:</span>
            <span class="coord-value" id="lng-value">0.0000</span>
        </div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel">
        <h3>Server Info</h3>

        <div class="info-section">
            <div class="info-row">
                <span class="info-label">Status:</span>
                <span class="status">RUNNING</span>
            </div>
            <div class="info-row">
                <span class="info-label">Server:</span>
                <span class="info-value">nginx/1.29.4</span>
            </div>
            <div class="info-row">
                <span class="info-label">Port:</span>
                <span class="info-value">3000</span>
            </div>
        </div>

        <div class="divider"></div>

        <div class="info-section">
            <div class="info-row">
                <span class="info-label">Tile Source:</span>
                <span class="info-value">Proxy + Cache</span>
            </div>
            <div class="info-row">
                <span class="info-label">Zoom Levels:</span>
                <span class="info-value">0 - 18</span>
            </div>
            <div class="info-row">
                <span class="info-label">Cache Size:</span>
                <span class="info-value">500 MB</span>
            </div>
        </div>

        <div class="divider"></div>

        <div class="info-section">
            <div class="info-row">
                <span class="info-label">Browser Cache:</span>
                <span class="info-value">3 days</span>
            </div>
            <div class="info-row">
                <span class="info-label">Proxy Cache:</span>
                <span class="info-value">8 days</span>
            </div>
            <div class="info-row">
                <span class="info-label">Inactive:</span>
                <span class="info-value">7 days</span>
            </div>
        </div>

        <div class="divider"></div>

        <div class="info-section">
            <div class="info-row">
                <span class="info-label">Rate Limit:</span>
                <span class="info-value">10 req/s</span>
            </div>
            <div class="info-row">
                <span class="info-label">CORS:</span>
                <span class="info-value">Enabled</span>
            </div>
        </div>

        <div class="note">
            Tiles fetched on-demand from OpenStreetMap and cached by nginx. Check X-Cache-Status header for HIT/MISS.
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Initialize the map
        const map = L.map('map', {
            center: [0, 0],
            zoom: 1,
            maxZoom: 18,  // Full zoom range with tile proxy
            minZoom: 0
        });

        // Add custom tile layer from our nginx server
        L.tileLayer('http://map.localhost:3000/tiles/{z}/{x}/{y}.png', {
            attribution: 'Tiles served by nginx | Map data &copy; OpenStreetMap',
            maxZoom: 18,
            tileSize: 256,
            errorTileUrl: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg=='
        }).addTo(map);

        // Add a marker at center with popup
        L.marker([0, 0]).addTo(map)
            .bindPopup('<b>Hello!</b><br>Your nginx tile server is working!<br><small>Zoom levels 0-18 via proxy</small>')
            .openPopup();

        // Update zoom level indicator
        function updateZoomLevel() {
            const zoom = map.getZoom();
            document.getElementById('zoom-level').textContent = zoom;
        }

        // Update coordinates display
        function updateCoordinates() {
            const center = map.getCenter();
            document.getElementById('lat-value').textContent = center.lat.toFixed(4);
            document.getElementById('lng-value').textContent = center.lng.toFixed(4);
        }

        // Initial updates
        updateZoomLevel();
        updateCoordinates();

        // Listen for map events
        map.on('zoomend', updateZoomLevel);
        map.on('move', updateCoordinates);
        map.on('moveend', updateCoordinates);

        // Log tile requests to console
        console.log('Map initialized with tile proxy');
        console.log('Tile URL template: http://map.localhost:3000/tiles/{z}/{x}/{y}.png');
        console.log('Watch the Network tab to see cache HIT/MISS in X-Cache-Status header');
        console.log('Zoom levels 0-18 available via OpenStreetMap proxy');

        // Log when tiles are loaded
        map.on('tileload', function(e) {
            console.log('Tile loaded:', e.url);
        });

        // Log when tiles fail to load
        map.on('tileerror', function(e) {
            console.warn('Tile not found (expected for areas without downloaded tiles):', e.tile.src);
        });
    </script>
</body>
</html>
